<!-- show_ratings.html  -->
{% extends 'fantasy_nba/base.html' %}
{% load static %}
{% load extras %}
{% load fantasy_nba_tags %}
{% block content %}
<!DOCTYPE html>
<html>
<head>
    <title>Sortable Ratings</title>
</head>
<body>
    <h1 class="header-big">Ratings</h1>

    <table id="ratings-table" class="styled-table">
        <thead>
            <tr>
                {% for column_key, display_name in column_display_names.items %}
                    <th>
                        <a href="{% url 'sort_ratings' %}?sort_by={{ column_key }}">
                            {{ display_name }}
                            {% if sort_by == column_key and sort_direction == 'asc' %} ▲{% endif %}
                            {% if sort_by == column_key and sort_direction == 'desc' %} ▼{% endif %}
                        </a>
                    </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody id="ratings-table-body">
            {% if ratings|length == 0 %}
                <tr><td colspan="{{ column_display_names|length }}">No ratings available</td></tr>
            {% else %}
                {% for row in ratings %}
                <tr>
                    {% for column_actual_name, column_display_name_val in column_display_names.items %}
                        {% with cell_content=row|get_item:column_actual_name %}
                            {% if cell_content|is_styled_cell %}
                                <td class="{{ cell_content.css_class|default:'' }}">
                                    {% if column_actual_name == "Name" or column_actual_name == "Player_ID" or column_actual_name == "TEAM_ID" %}
                                        {{ cell_content.value }}
                                    {% else %}
                                        {{ cell_content.value|floatformat:2|default:"N/A" }}
                                    {% endif %}
                                </td>
                            {% else %}
                                {# Fallback for unexpected data structure, or if a column is intentionally not wrapped #}
                                <td>
                                    {% if column_actual_name == "Name" or column_actual_name == "Player_ID" or column_actual_name == "TEAM_ID" %}
                                        {{ cell_content }} {# Assumes cell_content is the raw value #}
                                    {% else %}
                                        {{ cell_content|floatformat:2|default:"N/A" }}
                                    {% endif %}
                                </td>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </tr>
                {% endfor %}
            {% endif %}
            {# {% include 'fantasy_nba/ratings_table_rows.html' %} #} {# Commented out to prevent duplicate raw data #}
        </tbody>
    </table>
</body>
</html>
{% endblock %}