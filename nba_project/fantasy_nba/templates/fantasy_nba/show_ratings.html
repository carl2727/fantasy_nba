<!-- templates/fantasy_nba/show_ratings.html -->
{% extends 'fantasy_nba/base.html' %}
{% load static %}
{% load extras %}
{% load fantasy_nba_tags %}
{% block content %}
<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <h1 class="header-big">Ratings</h1>

    <table id="ratings-table" class="styled-table">
        <thead>
            <tr>
                {% for column_key, display_name in column_display_names.items %}
                    <th>
                        <a href="{% url 'sort_ratings' %}?sort_by={{ column_key }}">
                            {{ display_name }}
                            {% if sort_by == column_key and sort_direction == 'asc' %} ▲{% endif %}
                            {% if sort_by == column_key and sort_direction == 'desc' %} ▼{% endif %}
                        </a>
                    </th>
                {% endfor %}
                <th>
                    {% if active_team %}
                        Actions <!-- Changed from active_team.name for clarity -->
                    {% else %}
                        Tools
                    {% endif %}
                </th>
            </tr>
        </thead>
        <tbody id="ratings-table-body">
            {% if ratings|length == 0 %}
                <tr><td colspan="{{ column_display_names|length|add:1 }}">No ratings available</td></tr> <!-- Adjusted colspan -->
            {% else %}
                {% for row in ratings %}
                <tr>
                    {% for column_actual_name, column_display_name_val in column_display_names.items %}
                        {% with cell_content=row|get_item:column_actual_name %}
                            {% if cell_content|is_styled_cell %}
                                <td class="{{ cell_content.css_class|default:'' }}">
                                    {% if column_actual_name == "Name" or column_actual_name == "Player_ID" or column_actual_name == "TEAM_ID" or column_actual_name == "Status" %}
                                        {{ cell_content.value }}
                                    {% else %}
                                        {{ cell_content.value|floatformat:2|default:"N/A" }}
                                    {% endif %}
                                </td>
                            {% else %}
                                <td>
                                    {% if column_actual_name == "Name" or column_actual_name == "Player_ID" or column_actual_name == "TEAM_ID" or column_actual_name == "Status" %}
                                        {{ cell_content }}
                                    {% else %}
                                        {{ cell_content|floatformat:2|default:"N/A" }}
                                    {% endif %}
                                </td>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                    <td>
                        {% if user.is_authenticated and active_team %}
                            <!-- Button to set status to ON_TEAM -->
                            <form method="post" action="{% url 'update_player_status' %}" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="player_id" value="{{ row|get_item:'Player_ID'|get_item:'value'|default_if_none:'' }}">
                                <input type="hidden" name="status" value="ON_TEAM">
                                <button type="submit" title="Add to Team">+</button>
                            </form>
                            <!-- Button to set status to AVAILABLE -->
                            <form method="post" action="{% url 'update_player_status' %}" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="player_id" value="{{ row|get_item:'Player_ID'|get_item:'value'|default_if_none:'' }}">
                                <input type="hidden" name="status" value="AVAILABLE">
                                <button type="submit" title="Make Available">-</button>
                            </form>
                            <!-- Button to set status to UNAVAILABLE -->
                            <form method="post" action="{% url 'update_player_status' %}" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="player_id" value="{{ row|get_item:'Player_ID'|get_item:'value'|default_if_none:'' }}">
                                <input type="hidden" name="status" value="UNAVAILABLE">
                                <button type="submit" title="Make Unavailable">/</button>
                            </form>
                        {% else %}
                            <!-- Optional: Message if no active team or user not authenticated -->
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>

    
</body>
{% endblock %}
