<!-- show_ratings.html  -->
{% extends 'fantasy_nba/base.html' %}
{% load static %}
{% load extras %}
{% load fantasy_nba_tags %}
{% block content %}
<!DOCTYPE html>
<html>
<head>
    <title>Sortable Ratings</title>
    <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuV3HsxodGtHcjJEcUzjNWLmvMS06p+g0IBzlnPbNIuvlIr3PQ0aKlW" crossorigin="anonymous"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            box-sizing: border-box;
        }
        th a {
            display: block;
            text-decoration: none;
            color: inherit;
        }
        .sort-asc::after {
            content: " ▲";
        }
        .sort-desc::after {
            content: " ▼";
        }
        tbody {
            display: table-row-group;
        }
        .bg-green {
            background-color: #90EE90; /* LightGreen */
        }
        .bg-light-green {
            background-color: #C8E6C9; /* A paler green */
        }
        .bg-red {
            background-color: #F44336; /* A clear red */
            color: white; /* Text color for contrast */
        }
        .bg-light-red {
            background-color: #FFCDD2; /* A light red/pink */
        }

    </style>
</head>
<body>
    <h1>Ratings</h1>

    <table id="ratings-table">
        <thead>
            <tr>
                {% for column_key, display_name in column_display_names.items %}
                    <th>
                        <a href="{% url 'sort_ratings' %}?sort_by={{ column_key }}">
                            {{ display_name }}
                            {% if sort_by == column_key and sort_direction == 'asc' %} ▲{% endif %}
                            {% if sort_by == column_key and sort_direction == 'desc' %} ▼{% endif %}
                        </a>
                    </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody id="ratings-table-body">
            {% if ratings|length == 0 %}
                <tr><td colspan="{{ column_display_names|length }}">No ratings available</td></tr>
            {% else %}
                {% for row in ratings %}
                <tr>
                    {% for column_actual_name, column_display_name_val in column_display_names.items %}
                        {% with cell_content=row|get_item:column_actual_name %}
                            {% if cell_content|is_styled_cell %}
                                <td class="{{ cell_content.css_class|default:'' }}">
                                    {% if column_actual_name == "Name" or column_actual_name == "Player_ID" or column_actual_name == "TEAM_ID" %}
                                        {{ cell_content.value }}
                                    {% else %}
                                        {{ cell_content.value|floatformat:2|default:"N/A" }}
                                    {% endif %}
                                </td>
                            {% else %}
                                {# Fallback for unexpected data structure, or if a column is intentionally not wrapped #}
                                <td>
                                    {% if column_actual_name == "Name" or column_actual_name == "Player_ID" or column_actual_name == "TEAM_ID" %}
                                        {{ cell_content }} {# Assumes cell_content is the raw value #}
                                    {% else %}
                                        {{ cell_content|floatformat:2|default:"N/A" }}
                                    {% endif %}
                                </td>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </tr>
                {% endfor %}
            {% endif %}
            {# {% include 'fantasy_nba/ratings_table_rows.html' %} #} {# Commented out to prevent duplicate raw data #}
        </tbody>
    </table>
</body>
</html>
{% endblock %}