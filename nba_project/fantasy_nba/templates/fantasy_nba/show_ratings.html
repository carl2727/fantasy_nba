<!-- show_ratings.html  -->
{% extends 'fantasy_nba/base.html' %}
{% load static %}
{% load extras %}
{% load fantasy_nba_tags %}
{% block content %}
<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <h1 class="header-big">Ratings</h1>

    <table id="ratings-table" class="styled-table">
        <thead>
            <tr>
                {% for column_key, display_name in column_display_names.items %}
                    <th>
                        <a href="{% url 'sort_ratings' %}?sort_by={{ column_key }}">
                            {{ display_name }}
                            {% if sort_by == column_key and sort_direction == 'asc' %} ▲{% endif %}
                            {% if sort_by == column_key and sort_direction == 'desc' %} ▼{% endif %}
                        </a>
                    </th>
                {% endfor %}
                <th></th>
            </tr>
        </thead>
                <tbody id="ratings-table-body">
            {% if ratings|length == 0 %}
                <tr><td colspan="{{ column_display_names|length }}">No ratings available</td></tr>
            {% else %}
                {% for row in ratings %}
                <tr>
                    {% for column_actual_name, column_display_name_val in column_display_names.items %}
                        {% with cell_content=row|get_item:column_actual_name %}
                            {% if cell_content|is_styled_cell %}
                                <td class="{{ cell_content.css_class|default:'' }}">
                                    {% if column_actual_name == "Name" or column_actual_name == "Player_ID" or column_actual_name == "TEAM_ID" %}
                                        {{ cell_content.value }}
                                    {% else %}
                                        {{ cell_content.value|floatformat:2|default:"N/A" }}
                                    {% endif %}
                                </td>
                            {% else %}
                                <td>
                                    {% if column_actual_name == "Name" or column_actual_name == "Player_ID" or column_actual_name == "TEAM_ID" %}
                                        {{ cell_content }}
                                    {% else %}
                                        {{ cell_content|floatformat:2|default:"N/A" }}
                                    {% endif %}
                                </td>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                    <td>
                        {% if user.is_authenticated %}
                            <form method="post" action="{% url 'add_player' %}" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="player_id" value="{{ row|get_item:'Player_ID' }}">
                                <input type="hidden" name="player_name" value="{{ row|get_item:'Name' }}">
                                <button type="submit">+</button>
                            </form>
                            <form method="post" action="{% url 'remove_player' %}" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="player_id" value="{{ row|get_item:'Player_ID' }}">
                                <button type="submit">-</button>
                            </form>
                            <form method="post" action="{% url 'toggle_availability' %}" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="player_id" value="{{ row|get_item:'Player_ID' }}">
                                <button type="submit">
                                    {% if row.is_available %}Unavailable{% else %}Available{% endif %}
                                </button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</body>
</html>
{% endblock %}